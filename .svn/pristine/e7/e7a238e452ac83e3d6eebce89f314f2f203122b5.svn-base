jQuery(document).ready(function ($) {


    //make tabs tabs
    $("#tabs").tabs();

    //make links go to particular tabs
    $('.wrap').on("click", ".open-tab", function () {
        var tab = $(this).attr('href');
        var index = $(tab).index() - 1;
        $('#tabs').tabs({
            active: index
        });
    });


    //hides and then shows on click help tooltips
    $(".hidden").hide();
    $(".information-icon").click(function (event) {
        event.preventDefault();
        $(this).next(".hidden").slideToggle();
    });


    
    //runs get access token ajax
    var code = $('#wp_linkedin_autopublish_authorisation_code').val();
    var accessToken = $('#wp_linkedin_autopublish_access_token').val();

    if (code.length > 1 && accessToken.length < 1) {

        //do request    
        var data = {
            'action': 'get_access_token',
            'code': code,
        };


        jQuery.post(ajaxurl, data, function (response) {

            $('#wp_linkedin_autopublish_access_token').val(response);
            
            console.log(response);

            $('<div class="notice notice-info is-dismissible"><p>Please press the Save All Settings button.</p></div>').insertAfter('#wp_linkedin_autopublish_access_token');

        });

    }

    
    
    //show authorisation fields if client id and secret are filled in
    
    var clientId = $('#wp_linkedin_autopublish_client_id').val();
    var clientSecret = $('#wp_linkedin_autopublish_client_secret').val();
    
    if(clientId.length > 1 && clientSecret.length >1){
        $('.hidden-authorisation').show();    
    }




    
    //hide company select based on whether the user is using a company or profile

    $('#wp_linkedin_autopublish_profile_company :selected').each(function () {
        if ($(this).val() == "profile") {
            $(".company-option").hide();
        } else {
            $(".company-option").show();
        }
    });
    $('#wp_linkedin_autopublish_profile_company').change(function () {
        if ($(this).val() == "profile") {
            $(".company-option").hide();
        } else {
            $(".company-option").show();
        }
    });


    //adds button text to text area
    $('.linkedin_autopublish_append_buttons').click(function () {
        $(this).parent().next().children().val($(this).parent().next().children().val() + $(this).attr("value"));
        $(this).parent().next().children().focus();
    });



    
    
    //code to manage dont share categories

    var selectedDontShareCategories = $('#wp_linkedin_autopublish_dont_share_categories').val();

    if (selectedDontShareCategories != null) {
        var selectedDontShareCategoriesArray = selectedDontShareCategories.split(',');
    }

    $(".dont-share-checkbox").each(function () {

        if ($.inArray($(this).attr('id'), selectedDontShareCategoriesArray) != -1) {
            $(this).prop('checked', true);
        }

        $(this).change(function () {

            if ($(this).is(":checked")) {

                selectedDontShareCategoriesArray.push($(this).attr('id'));

                $('#wp_linkedin_autopublish_dont_share_categories').val(selectedDontShareCategoriesArray.join());

            } else {
                selectedDontShareCategoriesArray.splice($.inArray($(this).attr('id'), selectedDontShareCategoriesArray), 1);
                $('#wp_linkedin_autopublish_dont_share_categories').val(selectedDontShareCategoriesArray.join());
            }

        }); //end change function

    }); //end each function


});